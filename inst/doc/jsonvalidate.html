<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Rich FitzJohn" />

<meta name="date" content="2025-02-07" />

<title>Introduction to jsonvalidate</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to jsonvalidate</h1>
<h4 class="author">Rich FitzJohn</h4>
<h4 class="date">2025-02-07</h4>



<p>This package wraps <a href="https://github.com/mafintosh/is-my-json-valid">is-my-json-valid</a>
using <a href="https://cran.r-project.org/package=V8">V8</a> to do JSON
schema validation in R.</p>
<p>You need a JSON schema file; see <a href="https://json-schema.org/">json-schema.org</a> for details on
writing these. Often someone else has done the hard work of writing one
for you, and you can just check that the JSON you are producing or
consuming conforms to the schema.</p>
<p>The examples below come from the <a href="https://json-schema.org//learn/getting-started-step-by-step.html">JSON
schema website</a></p>
<p>They describe a JSON based product catalogue, where each product has
an id, a name, a price, and an optional set of tags. A JSON
representation of a product is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;A green door&quot;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">12.50</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;home&quot;</span><span class="ot">,</span> <span class="st">&quot;green&quot;</span><span class="ot">]</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The schema that they derive looks like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Product&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;A product from Acme&#39;s catalog&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;object&quot;</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="dt">&quot;properties&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>        <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>            <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;The unique identifier for a product&quot;</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;integer&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>            <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Name of the product&quot;</span><span class="fu">,</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;string&quot;</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>        <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;number&quot;</span><span class="fu">,</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>            <span class="dt">&quot;minimum&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>            <span class="dt">&quot;exclusiveMinimum&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>        <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;array&quot;</span><span class="fu">,</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>            <span class="dt">&quot;items&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;string&quot;</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>            <span class="dt">&quot;minItems&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>            <span class="dt">&quot;uniqueItems&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>    <span class="dt">&quot;required&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;id&quot;</span><span class="ot">,</span> <span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="st">&quot;price&quot;</span><span class="ot">]</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>This ensures the types of all fields, enforces presence of
<code>id</code>, <code>name</code> and <code>price</code>, checks that
the price is not negative and checks that if present <code>tags</code>
is a unique list of strings.</p>
<p>There are two ways of passing the schema in to R; as a string or as a
filename. If you have a large schema loading as a file will generally be
easiest! Here’s a string representing the schema (watch out for escaping
quotes):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>schema <span class="ot">&lt;-</span> <span class="st">&#39;{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="st">    &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;,</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="st">    &quot;title&quot;: &quot;Product&quot;,</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="st">    &quot;description&quot;: &quot;A product from Acme</span><span class="sc">\&#39;</span><span class="st">s catalog&quot;,</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="st">    &quot;type&quot;: &quot;object&quot;,</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="st">    &quot;properties&quot;: {</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="st">        &quot;id&quot;: {</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="st">            &quot;description&quot;: &quot;The unique identifier for a product&quot;,</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="st">            &quot;type&quot;: &quot;integer&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="st">        &quot;name&quot;: {</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="st">            &quot;description&quot;: &quot;Name of the product&quot;,</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="st">            &quot;type&quot;: &quot;string&quot;</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="st">        &quot;price&quot;: {</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="st">            &quot;type&quot;: &quot;number&quot;,</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="st">            &quot;minimum&quot;: 0,</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="st">            &quot;exclusiveMinimum&quot;: true</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="st">        &quot;tags&quot;: {</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="st">            &quot;type&quot;: &quot;array&quot;,</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="st">            &quot;items&quot;: {</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="st">                &quot;type&quot;: &quot;string&quot;</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="st">            },</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="st">            &quot;minItems&quot;: 1,</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="st">            &quot;uniqueItems&quot;: true</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="st">    &quot;required&quot;: [&quot;id&quot;, &quot;name&quot;, &quot;price&quot;]</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="st">}&#39;</span></span></code></pre></div>
<p>Create a schema object, which can be used to validate a schema:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>obj <span class="ot">&lt;-</span> jsonvalidate<span class="sc">::</span>json_schema<span class="sc">$</span><span class="fu">new</span>(schema)</span></code></pre></div>
<p>If we’d saved the json to a file, this would work too:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">writeLines</span>(schema, path)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>obj <span class="ot">&lt;-</span> jsonvalidate<span class="sc">::</span>json_schema<span class="sc">$</span><span class="fu">new</span>(path)</span></code></pre></div>
<p>The returned object is a function that takes as its first argument a
json string, or a filename of a json file. The empty list will fail
validation because it does not contain any of the required fields:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>obj<span class="sc">$</span><span class="fu">validate</span>(<span class="st">&quot;{}&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>To get more information on why the validation fails, add
<code>verbose = TRUE</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>obj<span class="sc">$</span><span class="fu">validate</span>(<span class="st">&quot;{}&quot;</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,&quot;errors&quot;)
##   instancePath schemaPath  keyword missingProperty
## 1              #/required required              id
## 2              #/required required            name
## 3              #/required required           price
##                               message          schema
## 1    must have required property &#39;id&#39; id, name, price
## 2  must have required property &#39;name&#39; id, name, price
## 3 must have required property &#39;price&#39; id, name, price
##                      parentSchema.$schema parentSchema.title
## 1 http://json-schema.org/draft-04/schema#            Product
## 2 http://json-schema.org/draft-04/schema#            Product
## 3 http://json-schema.org/draft-04/schema#            Product
##        parentSchema.description parentSchema.type
## 1 A product from Acme&#39;s catalog            object
## 2 A product from Acme&#39;s catalog            object
## 3 A product from Acme&#39;s catalog            object
##   parentSchema.properties.id.description parentSchema.properties.id.type
## 1    The unique identifier for a product                         integer
## 2    The unique identifier for a product                         integer
## 3    The unique identifier for a product                         integer
##   parentSchema.properties.name.description parentSchema.properties.name.type
## 1                      Name of the product                            string
## 2                      Name of the product                            string
## 3                      Name of the product                            string
##   parentSchema.properties.price.type parentSchema.properties.price.minimum
## 1                             number                                     0
## 2                             number                                     0
## 3                             number                                     0
##   parentSchema.properties.price.exclusiveMinimum
## 1                                           TRUE
## 2                                           TRUE
## 3                                           TRUE
##   parentSchema.properties.tags.type parentSchema.properties.tags.type
## 1                             array                            string
## 2                             array                            string
## 3                             array                            string
##   parentSchema.properties.tags.minItems
## 1                                     1
## 2                                     1
## 3                                     1
##   parentSchema.properties.tags.uniqueItems parentSchema.required dataPath
## 1                                     TRUE       id, name, price         
## 2                                     TRUE       id, name, price         
## 3                                     TRUE       id, name, price</code></pre>
<p>The attribute “errors” is a data.frame and is present only when the
json fails validation. The error messages come straight from
<code>ajv</code> and they may not always be that informative.</p>
<p>Alternatively, to throw an error if the json does not validate, add
<code>error = TRUE</code> to the call:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>obj<span class="sc">$</span><span class="fu">validate</span>(<span class="st">&quot;{}&quot;</span>, <span class="at">error =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Error: 3 errors validating json:
##  -  (#/required): must have required property &#39;id&#39;
##  -  (#/required): must have required property &#39;name&#39;
##  -  (#/required): must have required property &#39;price&#39;</code></pre>
<p>The JSON from the opening example works:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>obj<span class="sc">$</span><span class="fu">validate</span>(<span class="st">&#39;{</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="st">    &quot;id&quot;: 1,</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="st">    &quot;name&quot;: &quot;A green door&quot;,</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="st">    &quot;price&quot;: 12.50,</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="st">    &quot;tags&quot;: [&quot;home&quot;, &quot;green&quot;]</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="st">}&#39;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>But if we tried to enter a negative price it would fail:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>obj<span class="sc">$</span><span class="fu">validate</span>(<span class="st">&#39;{</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="st">    &quot;id&quot;: 1,</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="st">    &quot;name&quot;: &quot;A green door&quot;,</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="st">    &quot;price&quot;: -1,</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="st">    &quot;tags&quot;: [&quot;home&quot;, &quot;green&quot;]</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="st">}&#39;</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,&quot;errors&quot;)
##   instancePath                 schemaPath keyword params.comparison
## 1       /price #/properties/price/minimum minimum                 &gt;
##   params.limit     message schema parentSchema.type parentSchema.minimum
## 1            0 must be &gt; 0      0            number                    0
##   parentSchema.exclusiveMinimum data dataPath
## 1                          TRUE   -1   /price</code></pre>
<p>…or duplicate tags:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>obj<span class="sc">$</span><span class="fu">validate</span>(<span class="st">&#39;{</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="st">    &quot;id&quot;: 1,</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="st">    &quot;name&quot;: &quot;A green door&quot;,</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="st">    &quot;price&quot;: 12.50,</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="st">    &quot;tags&quot;: [&quot;home&quot;, &quot;home&quot;]</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="st">}&#39;</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,&quot;errors&quot;)
##   instancePath                    schemaPath     keyword params.i params.j
## 1        /tags #/properties/tags/uniqueItems uniqueItems        0        1
##                                                          message schema
## 1 must NOT have duplicate items (items ## 1 and 0 are identical)   TRUE
##   parentSchema.type parentSchema.type parentSchema.minItems
## 1             array            string                     1
##   parentSchema.uniqueItems       data dataPath
## 1                     TRUE home, home    /tags</code></pre>
<p>or just basically everything wrong:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>obj<span class="sc">$</span><span class="fu">validate</span>(<span class="st">&#39;{</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="st">    &quot;id&quot;: &quot;identifier&quot;,</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="st">    &quot;name&quot;: 1,</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="st">    &quot;price&quot;: -1,</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="st">    &quot;tags&quot;: [&quot;home&quot;, &quot;home&quot;, 1]</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="st">}&#39;</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,&quot;errors&quot;)
##   instancePath                    schemaPath     keyword params.type
## 1          /id          #/properties/id/type        type     integer
## 2        /name        #/properties/name/type        type      string
## 3       /price    #/properties/price/minimum     minimum        &lt;NA&gt;
## 4      /tags/2  #/properties/tags/items/type        type      string
## 5        /tags #/properties/tags/uniqueItems uniqueItems        &lt;NA&gt;
##   params.comparison params.limit params.i params.j
## 1              &lt;NA&gt;           NA       NA       NA
## 2              &lt;NA&gt;           NA       NA       NA
## 3                 &gt;            0       NA       NA
## 4              &lt;NA&gt;           NA       NA       NA
## 5              &lt;NA&gt;           NA        0        1
##                                                          message  schema
## 1                                                must be integer integer
## 2                                                 must be string  string
## 3                                                    must be &gt; 0       0
## 4                                                 must be string  string
## 5 must NOT have duplicate items (items ## 1 and 0 are identical)    TRUE
##              parentSchema.description parentSchema.type parentSchema.minimum
## 1 The unique identifier for a product           integer                   NA
## 2                 Name of the product            string                   NA
## 3                                &lt;NA&gt;            number                    0
## 4                                &lt;NA&gt;            string                   NA
## 5                                &lt;NA&gt;             array                   NA
##   parentSchema.exclusiveMinimum parentSchema.type parentSchema.minItems
## 1                            NA              &lt;NA&gt;                    NA
## 2                            NA              &lt;NA&gt;                    NA
## 3                          TRUE              &lt;NA&gt;                    NA
## 4                            NA              &lt;NA&gt;                    NA
## 5                            NA            string                     1
##   parentSchema.uniqueItems          data dataPath
## 1                       NA    identifier      /id
## 2                       NA             1    /name
## 3                       NA            -1   /price
## 4                       NA             1  /tags/2
## 5                     TRUE home, home, 1    /tags</code></pre>
<p>The names comes from within the <code>ajv</code> source, and may be
annoying to work with programmatically.</p>
<p>There is also a simple interface where you take the schema and the
json at the same time:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>json <span class="ot">&lt;-</span> <span class="st">&#39;{</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="st">    &quot;id&quot;: 1,</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="st">    &quot;name&quot;: &quot;A green door&quot;,</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="st">    &quot;price&quot;: 12.50,</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="st">    &quot;tags&quot;: [&quot;home&quot;, &quot;green&quot;]</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>jsonvalidate<span class="sc">::</span><span class="fu">json_validate</span>(json, schema, <span class="at">engine =</span> <span class="st">&quot;ajv&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>However, this will be much slower than building the schema object
once and using it repeatedly.</p>
<p>Prior to 1.4.0, the recommended way of building a reusable validator
object was to use <code>jsonvalidate::json_validator</code>; this is
still supported but note that it has different defaults to
<code>jsonvalidate::json_schema</code> (using imjv for backward
compatibility).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>v <span class="ot">&lt;-</span> jsonvalidate<span class="sc">::</span><span class="fu">json_validator</span>(schema, <span class="at">engine =</span> <span class="st">&quot;ajv&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">v</span>(json)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>While we do not intend on removing this old interface, new code
should prefer both <code>jsonvalidate::json_schema</code> and the
<code>ajv</code> engine.</p>
<div id="combining-schemas" class="section level2">
<h2>Combining schemas</h2>
<p>You can combine schemas with <code>ajv</code> engine. You can
reference definitions within one schema</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>schema <span class="ot">&lt;-</span> <span class="st">&#39;{</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="st">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;,</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="st">  &quot;definitions&quot;: {</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="st">    &quot;city&quot;: { &quot;type&quot;: &quot;string&quot; }</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="st">  },</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="st">  &quot;type&quot;: &quot;object&quot;,</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="st">  &quot;properties&quot;: {</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="st">    &quot;city&quot;: { &quot;$ref&quot;: &quot;#/definitions/city&quot; }</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>json <span class="ot">&lt;-</span> <span class="st">&#39;{</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="st">    &quot;city&quot;: &quot;Firenze&quot;</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>jsonvalidate<span class="sc">::</span><span class="fu">json_validate</span>(json, schema, <span class="at">engine =</span> <span class="st">&quot;ajv&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>You can reference schema from other files</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>city_schema <span class="ot">&lt;-</span> <span class="st">&#39;{</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="st">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema&quot;,</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="st">  &quot;type&quot;: &quot;string&quot;,</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="st">  &quot;enum&quot;: [&quot;Firenze&quot;]</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>address_schema <span class="ot">&lt;-</span> <span class="st">&#39;{</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="st">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema&quot;,</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="st">  &quot;type&quot;:&quot;object&quot;,</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="st">  &quot;properties&quot;: {</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="st">    &quot;city&quot;: { &quot;$ref&quot;: &quot;city.json&quot; }</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="fu">dir.create</span>(path)</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>address_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="st">&quot;address.json&quot;</span>)</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>city_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="st">&quot;city.json&quot;</span>)</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="fu">writeLines</span>(address_schema, address_path)</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="fu">writeLines</span>(city_schema, city_path)</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>jsonvalidate<span class="sc">::</span><span class="fu">json_validate</span>(json, address_path, <span class="at">engine =</span> <span class="st">&quot;ajv&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>You can combine schemas in subdirectories. Note that the
<code>$ref</code> path needs to be relative to the schema path. You
cannot use absolute paths in <code>$ref</code> and jsonvalidate will
throw an error if you try to do so.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>user_schema <span class="ot">=</span> <span class="st">&#39;{</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="st">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema&quot;,</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="st">  &quot;type&quot;: &quot;object&quot;,</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="st">  &quot;required&quot;: [&quot;address&quot;],</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="st">  &quot;properties&quot;: {</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="st">    &quot;address&quot;: {</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="st">      &quot;$ref&quot;: &quot;sub/address.json&quot;</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>json <span class="ot">&lt;-</span> <span class="st">&#39;{</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="st">  &quot;address&quot;: {</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a><span class="st">    &quot;city&quot;: &quot;Firenze&quot;</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>subdir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="st">&quot;sub&quot;</span>)</span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a><span class="fu">dir.create</span>(subdir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>city_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(subdir, <span class="st">&quot;city.json&quot;</span>)</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>address_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(subdir, <span class="st">&quot;address.json&quot;</span>)</span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>user_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="st">&quot;schema.json&quot;</span>)</span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a><span class="fu">writeLines</span>(city_schema, city_path)</span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a><span class="fu">writeLines</span>(address_schema, address_path)</span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a><span class="fu">writeLines</span>(user_schema, user_path)</span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>jsonvalidate<span class="sc">::</span><span class="fu">json_validate</span>(json, user_path, <span class="at">engine =</span> <span class="st">&quot;ajv&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
